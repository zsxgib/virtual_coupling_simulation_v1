# Figures 改进方案

## 一、论文核心修改：触发条件加入指数衰减项

论文已修改触发条件为：
```
||e_i(t)|| > σ_i(t) × ||δ_i(t)|| / (L_ii × ||H_i||) + μ_i × e^(-ν_i t)
```

新增参数：
- μ: 衰减幅度
- ν: 衰减速率

**作用**：随着时间推移，触发条件越来越严格，触发次数减少。

---

## 二、原论文 (IEEE TNNLS 2023) Fig.2-4 的作用

| 图形 | 核心作用 | 回答的问题 |
|------|----------|------------|
| Fig.2 | 状态轨迹 | **共识能否达到？** (状态收敛) |
| Fig.3 | 跟踪误差 | **误差如何收敛？** (收敛到0) |
| Fig.4 | 耦合系数演化 | **参数如何自适应？** (c从0增加到~0.25) |
| Fig.5 | 触发时刻 | **何时通信？** (离散事件) |

**特点**: 每张图**只回答一个问题**，非常纯粹。

---

## 三、当前仿真 (virtual_coupling) Fig.1-5 的问题

| 图形 | 当前内容 | 问题 |
|------|----------|------|
| Fig.1a | 拓扑 | ✓ 已拆分，可用 |
| Fig.1b | 相轨迹 | ✓ 已拆分，可用 |
| Fig.2 | 5方案误差对比 | ❌ **曲线太多难以区分** |
| Fig.3 | 触发事件散点 | ❌ **散点太密，难以阅读** |
| Fig.4 | 阈值演化 + 参数估计 | ⚠️ 三条曲线(C/D/E)太相似 |
| Fig.5 | 通信量柱状图 | ❌ **触发次数过高** |

---

## 四、核心问题：触发次数过高

### 问题根源

当前触发条件：
```
||e|| > σ × ||δ||
```

**没有指数衰减项**，导致：
- 触发条件一直相对宽松
- 触发次数过高（方案B: 6984次/60秒 ≈ 116次/秒）

### 论文修改后的触发条件

```
||e|| > σ × ||δ|| + μ × e^(-νt)
```

- 前期 (t小): μe^(-νt) 大 → 触发容易 → 适当通信
- 后期 (t大): μe^(-νt) 小 → 触发困难 → 减少通信

---

## 五、改进方向

### 1. Fig.1 ✓ 已完成

**状态**: 已拆分为 Fig.1a(拓扑) 和 Fig.1b(相轨迹)

---

### 2. Fig.2 分析与改进

#### 2.1 Fig.2 的目标

**目标**: 证明"在事件触发控制下，系统误差能收敛"

#### 2.2 曲线相似的分析

**重要发现**: 曲线相似是**合理的**！

原因：
1. 所有方案使用**相同的控制器增益K**
2. 事件触发只影响"何时通信"，不直接影响控制律
3. 最终目标：**在保持控制性能的前提下减少通信**

#### 2.3 当前问题

**问题**: 初始误差设置为0，导致曲线完全重合

当两者都为0时：
- 所有车速度相同：22.22 m/s
- 位置等间距：-500, -1000, -1500...
- 相对误差 δ = [位置误差, 速度误差] = [0, 0]

#### 2.4 修改建议

设置非零的初始误差：
- 位置扰动 p_initial_std = 50.0
- 速度扰动 v_initial_std = 2.0

修改后效果：
- 初始误差非零
- 所有方案有相同的初始条件（公平对比）
- 曲线有动态过程可看

---

### 3. Fig.3 改进（原问题：散点太密 + 触发次数高）

**核心解决**: 在触发条件中加入指数衰减项 μe^(-νt)

**预期效果**:
- 前期 (t小): 衰减项大 → 适当触发
- 后期 (t大): 衰减项小 → 减少触发

---

### 4. Fig.4 改进（原问题：三条曲线太相似）

**当前**: C/D/E三条阈值演化曲线差异不明显

**原因分析**:
- 当前σ的变化范围和速度相近
- 需要配合指数衰减项才能体现差异

**改进**: 配合指数衰减项后，阈值演化曲线会更有区分度

---

### 5. Fig.5 改进（触发次数过高）

**问题**: 当前触发次数过高（方案B: 6984次/60秒）

**解决**: 加入指数衰减项后，预期触发次数大幅减少

| 方案 | 当前(无衰减项) | 预期(有衰减项) |
|------|---------------|----------------|
| A (periodic) | 960 | 960 |
| B (fixed) | ~7000 | ~1000-2000 |
| C/D/E | ~6000-7000 | ~500-1500 |

---

## 六、详细效果标准

| 图形 | 论文中的作用 | 回答的核心问题 | 当前结果 | 达到效果的标准 | 实际情况 |
|------|-------------|---------------|----------|---------------|----------|
| **Fig1a** | 拓扑结构 | 系统是什么？（8列车通信拓扑） | 拓扑图 | 正确显示8车通信拓扑，包含领航车和跟随车 | ✓ 显示了8车拓扑，包含领航车和跟随车 |
| **Fig1b** | 相轨迹 | 状态如何演化？（收敛到平衡点） | 相轨迹图 | 状态收敛到平衡点（速度22.22m/s，间距500m），形成稳定编队 | 需验证收敛到平衡点 |
| **Fig2** | 误差收敛对比 | 事件触发下控制性能是否下降？ | 5条误差曲线 | 1) 误差‖δ‖趋于0或<10；2) 不震荡发散 | 误差在5-30波动，未趋于0 ❌ |
| **Fig3** | 触发事件分布 | 何时触发？有无Zeno问题？ | 触发时刻散点 | 1) 前期密集、后期稀疏；2) 最小间隔>10ms | 有13-22次<10ms触发，0ms触发也存在 ❌ |
| **Fig4a** | 阈值演化 | 自适应阈值σ如何变化？ | σ随时间变化曲线 | σ有明显的上升/下降变化（非恒定值） | 需检查σ是否变化 |
| **Fig4b** | 参数估计 | Â, B̂ 如何收敛？ | Â, B̂演化曲线 | Â和B̂收敛到有限值，不再增长或震荡 | 需检查参数演化 |
| **Fig5** | 通信量对比 | 事件触发能否节省通信？ | 触发次数柱状图 | **至少一个方案 < 定时触发(480次)** | C方案289次 < 480次 ✓ |

### 详细标准说明

#### Fig1a 拓扑结构
- **达到效果**：清晰展示8辆列车的通信拓扑，包含：
  - 领航车（Leader）节点
  - 跟随车（Follower）节点
  - 有向边表示通信方向（后车→前车）
- **实际情况**：✓ 达标 - 显示了8车拓扑，包含领航车和跟随车

#### Fig1b 相轨迹
- **达到效果**：
  - 相轨迹收敛到稳定平衡点
  - 平衡点满足：速度=22.22m/s，间距=500m
  - 不出现发散或持续震荡
- **实际情况**：需验证 - 需检查状态是否收敛到平衡点

#### Fig2 误差收敛对比
- **达到效果**：
  1. 相对状态误差‖δ‖最终趋于0或<10
  2. 不同方案（A/B/C/D/E）的误差曲线趋势一致
  3. 不出现震荡发散
- **实际情况**：❌ 未达标
  - 误差在5-30之间波动，未趋于0
  - 最终误差：Periodic≈10, Fixed≈7-8, Error-Driven≈5, State-Driven≈30, Lyapunov≈5

#### Fig3 触发事件分布
- **达到效果**：
  1. 触发事件在仿真前期较密集，随时间推移逐渐稀疏
  2. 最小触发间隔 > 10ms（zeno_interval），证明无Zeno问题
  3. 触发时刻分布均匀，无连续触发
- **实际情况**：❌ 未达标 - 存在Zeno现象
  - B: 349次触发，13次<10ms，10次<1ms（含0ms）
  - C: 289次触发，13次<10ms，9次<1ms（含0ms）
  - D: 349次触发，18次<10ms，12次<1ms（含0ms）
  - E: 380次触发，22次<10ms，12次<1ms（含0ms）

#### Fig4a 阈值演化
- **达到效果**：
  1. σ随时间有明显的自适应变化
  2. 对于方案C/D/E，σ应从初始值演化到不同稳态值
  3. 方案B的σ保持不变（固定阈值）
- **实际情况**：需验证 - 需查看sigma_*.npy数据

#### Fig4b 参数估计
- **达到效果**：
  1. Â和B̂的范数或主要元素收敛到有限值
  2. 不出现持续增长或发散
  3. 参数估计有助于补偿名义模型与真实系统的偏差
- **实际情况**：需验证 - 需查看A_hat_*.npy和B_hat_*.npy数据

#### Fig5 通信量对比（核心指标）
- **达到效果**：**事件触发总次数 < 定时触发总次数**
  - 定时触发：T_end / periodic_interval × n_trains = 60/1 × 8 = 480次
  - 事件触发方案应 < 480次
- **实际情况**：✓ 达标
  - A (Periodic): 480次 = 基准
  - B (Fixed): 349次 = **-27%** ✓
  - C (Error-Driven): 289次 = **-40%** ✓ ✓
  - D (State-Driven): 349次 = **-27%** ✓
  - E (Lyapunov): 380次 = **-21%** ✓
